webpackJsonp([19],{"Vg+r":function(t,e,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=l("0oES");var o={name:"order",inject:["reload"],data:function(){return{list1:[],chuliforms:!1,chakanforms:!1,detailData:[],list:[{label:"ID"},{label:"stage"},{label:"errlevel"},{label:"stagestatus"},{label:"errormessage"},{label:"sql"},{label:"affected_rows"},{label:"sequence"},{label:"execute_time"},{label:"SQLSHA1"}],xianshi3:!1,sql_result:[],sql_rollback:[],xianshi4:!1,caozuo:"订单处理",total:10,rstform:!1,pagesize:10,currentPage:1,btnChangeEnable:!0,yonghuming:"",zhuangtai:!1,jinggao:!1,xianshi5:!1,detail:[],resultforms:!1,cep_result:[]}},created:function(){this.current_change(1)},methods:{handleClick:function(t,e){var l,o,r=this;(l=t,o=e,Object(a.a)({url:"http://10.254.124.60:9000/order/list/",method:"post",data:{order_id:l,order_opeation:o}})).then(function(t){r.detailData=t.data.result,r.chuliforms=!0,"工单已驳回"===t.data.status?(r.btnChangeEnable=!0,r.xianshi3=!1):r.btnChangeEnable=!1})},handleClick2:function(t){var e,l=this;this.rstform=!0,(e=t,Object(a.a)({url:"http://10.254.124.60:9000/inception_result/",method:"post",data:{order_id:e}})).then(function(t){l.cep_result=t.data.result,console.log(l.cep_result)})},chuli:function(t){return console.log(t),"处理事务成功"===t?(console.log("test2"),!0):(console.log("test3"),!1)},chuli1:function(t){return"回滚事务"===t?"yangshi":"工单已驳回"===t?"yangshi1":"yangshi2"},current_change:function(t){var e,l=this;this.currentPage=t,console.log(this.currentPage),(e=this.currentPage,Object(a.a)({url:"http://10.254.124.60:9000/auth_order/?page="+e,method:"get"})).then(function(t){l.list1=t.data.results,l.total=t.data.count})},inception_go:function(t){var e=this;this.zhuangtai=!0,function(t){return Object(a.a)({url:"http://10.254.124.60:9000/order/",method:"post",data:{row:t}})}(t).then(function(t){e.zhuangtai=!1,e.sql_result=t.data.inception_result,e.sql_rollback=t.data.inception_sql,e.xianshi3=!0,e.caozuo="结果查看",e.reload()}).catch(function(t){alert(t)})},chakan:function(t){this.chakanforms=!0,this.detail=[t]},inception_notgo:function(t){var e,l=this;console.log(t),(e=t[0].order_id,Object(a.a)({url:"http://10.254.124.60:9000/order/list/",method:"post",data:{order_id:e}})).then(function(t){l.chuliforms=!1,l.caozuo="工单已拒绝",l.reload()}).catch(function(t){alert(t)})}}},r={render:function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",[l("el-table",{ref:"multipleTable",staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:t.list1,border:"",width:"100%"}},[l("el-table-column",{attrs:{prop:"order_id",label:"工单ID"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_title",label:"工单内容"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_user",label:"提交用户"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_sql_db",label:"数据库"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_sql_backup",label:"工单状态"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_status",label:"工单状态"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_time",label:"提交时间"}}),t._v(" "),l("el-table-column",{attrs:{label:"查看"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-button",{on:{click:function(l){return t.chakan(e.row)}}},[t._v("sql查看")])]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"操作1"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-button",{class:t.chuli1(e.row.order_opeation),on:{click:function(l){return t.handleClick(e.row.order_id,e.row.order_opeation)}}},[t._v(t._s(e.row.order_opeation))])]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"操作2"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-button",{on:{click:function(l){return t.handleClick2(e.row.order_id)}}},[t._v("结果查看")])]}}])}),t._v(" "),l("el-table-column",{attrs:{label:"操作3"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("el-button",{on:{click:function(l){return t.handleClick(e.row.order_id,e.row.order_opeation)}}},[t._v("sql回滚")])]}}])})],1),t._v(" "),l("el-pagination",{staticClass:"fy",attrs:{layout:"prev, pager, next",total:t.total,background:""},on:{"current-change":t.current_change}}),t._v(" "),l("el-dialog",{staticClass:"dialog-wrap",attrs:{title:"查看订单",visible:t.chakanforms,"append-to-body":!1},on:{"update:visible":function(e){t.chakanforms=e}}},[l("el-table",{ref:t.detail,staticStyle:{"margin-top":"20px"},attrs:{data:t.detail,border:"",ref:"multipleTable"}},[l("el-table-column",{attrs:{prop:"order_sql_text",label:"具体sql"},scopedSlots:t._u([{key:"default",fn:function(e){return[l("pre",[t._v(t._s(e.row.order_sql_text))])]}}])}),t._v(" "),l("el-button",{on:{click:function(e){t.chakanforms=!1}}},[t._v("取消")])],1)],1),t._v(" "),l("el-dialog",{staticClass:"dialog-wrap",attrs:{title:"查看结果",visible:t.rstform,"append-to-body":!1},on:{"update:visible":function(e){t.rstform=e}}},[l("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.cep_result}},t._l(t.list,function(e,a){return l("el-table-column",{key:a,attrs:{label:e.label,width:e.width},scopedSlots:t._u([{key:"default",fn:function(a){return[l("span",[t._v(t._s(a.row[e.label]))])]}}],null,!0)})}),1)],1),t._v(" "),l("el-dialog",{staticClass:"dialog-wrap",attrs:{title:"回滚语句",visible:t.chuliforms,"append-to-body":!1},on:{"update:visible":function(e){t.chuliforms=e}}},[l("el-table",{ref:t.detailData,staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:t.detailData,border:"",width:"100%",ref:"multipleTable"}},[l("el-table-column",{attrs:{prop:"order_id",label:"工单ID"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_title",label:"工单内容"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_sql_host",label:"数据库服务器"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_sql_db",label:"数据库"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_sql_text",label:"具体的sql语句","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[l("pre",[t._v(t._s(e.row.order_sql_text))])]}}])}),t._v(" "),l("el-table-column",{attrs:{prop:"order_user",label:"提交者"}}),t._v(" "),l("el-table-column",{attrs:{prop:"order_opeation",label:"状态"}})],1),t._v(" "),t.xianshi3?l("el-table",{staticStyle:{width:"100%"},attrs:{data:t.sql_result||[]}},t._l(t.list,function(e,a){return l("el-table-column",{key:a,attrs:{label:e.label,width:e.width},scopedSlots:t._u([{key:"default",fn:function(a){return[l("span",[t._v(t._s(a.row[e.label]))])]}}],null,!0)})}),1):t._e(),t._v(" "),l("el-button",{attrs:{disabled:t.btnChangeEnable,loading:t.zhuangtai},on:{click:function(e){return t.inception_go(t.detailData)}}},[t._v("执行工单")]),t._v(" "),l("el-button",{on:{click:function(e){return t.inception_notgo(t.detailData)}}},[t._v("驳回工单")]),t._v(" "),l("el-button",{on:{click:function(e){t.chuliforms=!1}}},[t._v("取消")])],1)],1)},staticRenderFns:[]};var n=l("VU/8")(o,r,!1,function(t){l("nJ48")},"data-v-26fda66c",null);e.default=n.exports},"Vp+K":function(t,e,l){(t.exports=l("FZ+f")(!1)).push([t.i,"\n.yangshi[data-v-26fda66c] {\n  background-color: #DAA520;\n}\n.yangshi1[data-v-26fda66c] {\n  background-color: #EE1000;\n}\n.yangshi2[data-v-26fda66c] {\n  background-color: #00BFFF;\n}\npre[data-v-26fda66c] {\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n",""])},nJ48:function(t,e,l){var a=l("Vp+K");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);l("rjj0")("3d4b9cac",a,!0,{})}});