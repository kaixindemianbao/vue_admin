webpackJsonp([29],{VWVu:function(t,e,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=l("G87+"),s=l("0oES");var i=l("QB0O"),n={name:"Sqlselect",border:!0,data:function(){return{message:"nihao",shiwu:{host:"",db:"",table_named:"",backup:"",sql_text:"",sql_type:"",sql_zhuti:"",dev_manager:"",sql_user:""},disableds:!1,backuplist:[{label:"备份"},{label:"不备份"}],dd:[{label:"DML类型"},{label:"DDL类型"}],username:[],result:[],usernamed:[],userlist:[],rows:[],addform:"",result2:[],scope:"",stripe:!0,dblist2:[],dbnamelist:[],table_name:[],ip:"",indexed:[],Non_unique:"",status:"",total:10,pagesize:9,currentPage:1,keyword:"",file:"",cc:[],url:" ",xianshi1:!1,xianshi2:!1,xianshi3:!1,sql_result:[],list:[{label:"ID"},{label:"stage"},{label:"errlevel"},{label:"stagestatus"},{label:"errormessage"},{label:"sql"},{label:"affected_rows"},{label:"sequence"},{label:"execute_time"},{label:"SQLSHA1"}],inception_error:"",manager_user:[],m_port:"",m_db:"",hs_type:"Master",rules:{sql_text:[{validator:function(t,e,l){new RegExp(".*drop|truncate.*").test(e)?l(new Error("很抱歉,不允许提交DROP/TRUNCATE语句")):l()},trigger:"blur"}]},lastatus:!1}},methods:{user_list:function(){var t=this;Object(i.e)(this.manager_user).then(function(e){t.manager_user=e.data,console.log(t.manager_user)})},selectGet:function(){var t=this;Object(a.b)(this.hs_type).then(function(e){t.dblist2=e.data.host,console.log(e.data)}).catch(function(t){alert(t)})},dbtableGet:function(){var t=this;Object(a.n)(this.shiwu).then(function(e){t.table_name=e.data}).catch(function(t){alert(t)})},selectDB:function(){var t=this;Object(a.a)(this.shiwu.hostname).then(function(e){t.m_db=e.data.db_port}).catch(function(t){alert(t)})},tijiao:function(){var t=this;this.disableds=!0,this.$refs.shiwu.validate(function(e){var l,a,i,n,r,u,o;e?(l=t.shiwu.hostname,a=t.shiwu.backup,i=t.shiwu.db,n=t.shiwu.sql_zhuti,r=t.shiwu.sql_text,u=t.shiwu.dev_manager,o=t.shiwu.sql_type,Object(s.a)({url:"http://10.254.124.60:9000/mysql_dml/",method:"post",data:{hostname:l,backup:a,db:i,zhuti:n,sql:r,dev_manager:u,sql_type:o}})).then(function(e){t.inception_error=e.data.status,t.keyword=e.data.keyword,t.sql_result=e.data.result,t.xianshi3=!0,t.disableds=!1,"success"===t.inception_error?t.lastatus=!0:t.lastatus=!1}).catch(function(t){this.disableds=!1,alert(t)}):console.log("验证失败")})}}},r={render:function(){var t=this,e=t.$createElement,l=t._self._c||e;return l("div",[l("el-form",{ref:"shiwu",attrs:{id:"#shiwu",model:t.shiwu,"label-width":"80px",rules:t.rules}},[l("el-form-item",{staticStyle:{"margin-bottom":"10px",width:"50%"},attrs:{label:"主机名:",prop:"string"}},[l("el-select",{staticStyle:{width:"100%"},nativeOn:{click:function(e){return t.selectGet(e)}},model:{value:t.shiwu.hostname,callback:function(e){t.$set(t.shiwu,"hostname",e)},expression:"shiwu.hostname"}},t._l(t.dblist2,function(t,e){return l("el-option",{key:e,attrs:{label:t.m_host,value:t.m_host}})}),1)],1),t._v(" "),l("el-form-item",{staticStyle:{"margin-bottom":"10px",width:"50%"},attrs:{label:"数据库名:",prop:"string"}},[l("el-select",{staticStyle:{width:"100%"},nativeOn:{click:function(e){return t.selectDB(e)}},model:{value:t.shiwu.db,callback:function(e){t.$set(t.shiwu,"db",e)},expression:"shiwu.db"}},t._l(t.m_db,function(t,e){return l("el-option",{key:e,attrs:{label:t.m_db,value:t.m_db}})}),1)],1),t._v(" "),l("el-form-item",{staticStyle:{"margin-bottom":"10px",width:"50%"},attrs:{label:"表名:",prop:"string"}},[l("el-select",{staticStyle:{width:"100%"},nativeOn:{click:function(e){return t.dbtableGet(e)}},model:{value:t.shiwu.tablenamed,callback:function(e){t.$set(t.shiwu,"tablenamed",e)},expression:"shiwu.tablenamed"}},t._l(t.table_name,function(t,e){return l("el-option",{key:e,attrs:{label:t.Table,value:t.Table}})}),1)],1),t._v(" "),l("el-form-item",{staticStyle:{"margin-bottom":"10px",width:"50%"},attrs:{label:"是否备份:",prop:"string"}},[l("el-select",{staticStyle:{width:"100%"},nativeOn:{click:function(e){return t.dbtableGet(e)}},model:{value:t.shiwu.backup,callback:function(e){t.$set(t.shiwu,"backup",e)},expression:"shiwu.backup"}},t._l(t.backuplist,function(t,e){return l("el-option",{key:e,attrs:{label:t.label,value:t.label}})}),1)],1),t._v(" "),l("el-form-item",{staticStyle:{"margin-bottom":"50px",width:"50%"},attrs:{label:"sql主题",prop:"sql_text"}},[l("el-input",{model:{value:t.shiwu.sql_zhuti,callback:function(e){t.$set(t.shiwu,"sql_zhuti",e)},expression:"shiwu.sql_zhuti"}})],1),t._v(" "),l("el-form-item",{staticStyle:{"margin-bottom":"50px",width:"50%"},attrs:{label:"sql类型",prop:"string"}},[l("el-select",{staticStyle:{width:"100%"},model:{value:t.shiwu.sql_type,callback:function(e){t.$set(t.shiwu,"sql_type",e)},expression:"shiwu.sql_type"}},t._l(t.dd,function(t,e){return l("el-option",{key:e,attrs:{label:t.label,value:t.label}})}),1)],1),t._v(" "),l("el-form-item",{staticStyle:{"margin-bottom":"50px",width:"50%"},attrs:{label:"sql语句",prop:"sql_text"}},[l("el-input",{attrs:{autosize:"",type:"textarea"},model:{value:t.shiwu.sql_text,callback:function(e){t.$set(t.shiwu,"sql_text",e)},expression:"shiwu.sql_text"}})],1),t._v(" "),l("el-form-item",{staticStyle:{"margin-bottom":"10px",width:"50%"},attrs:{label:"审核人:",prop:"string"}},[l("el-select",{staticStyle:{width:"100%"},nativeOn:{click:function(e){return t.user_list(e)}},model:{value:t.shiwu.dev_manager,callback:function(e){t.$set(t.shiwu,"dev_manager",e)},expression:"shiwu.dev_manager"}},t._l(t.manager_user,function(t,e){return l("el-option",{key:e,attrs:{label:t.label,value:t.dev_manager}})}),1)],1),t._v(" "),l("el-button",{attrs:{type:"primary",disabled:t.lastatus,loading:t.disableds},on:{click:t.tijiao}},[t._v("提交")])],1),t._v(" "),t.xianshi3?l("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.sql_result}},t._l(t.list,function(e,a){return l("el-table-column",{key:a,attrs:{label:e.label,width:e.width},scopedSlots:t._u([{key:"default",fn:function(a){return[l("span",[t._v(t._s(a.row[e.label]))])]}}],null,!0)})}),1):t._e(),t._v(" "),l("p",[t._v(t._s(t.keyword))]),t._v(" "),l("p",[t._v(t._s(t.inception_error))])],1)},staticRenderFns:[]},u=l("VU/8")(n,r,!1,null,null,null);e.default=u.exports}});